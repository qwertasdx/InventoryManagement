@model InventoryManagement.ViewModel.ItemBasicSearchViewModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "商品基本資料";
}
<style>
    .form-select1{
        display: inline;   
        padding:.325rem .55rem;
        width:15%
    } 
</style>

<h1>商品基本資料</h1>
<div>
<form action="/ItemBasics/SearchRule" method="get">
    <label>產品狀態:</label>
     <select name="Status" class="form-select1">
                    @foreach (var temp in Model.StatusList)
                    {
                        if (temp.Value == ViewBag.selectStatus2)
                        {
                            <option value="@temp.Value" selected>@temp.Text</option>
                        }
                        else
                        {
                            <option value="@temp.Value">@temp.Text</option>
                        }
                    }
                </select> 

     <label>分類:</label>
                <select name="Spec" class="form-select1">
                    @foreach (var temp in Model.SpecList)
                    {
                        if (temp.Value == ViewBag.selectSpec2)
                        {
                            <option value="@temp.Value" selected>@temp.Text</option>
                        }
                        else
                        {
                            <option value="@temp.Value">@temp.Text</option>
                        }
                    }
                </select>     
    <button type="submit">搜尋</button>
</form>
</div>
<table class="table">
    <thead>
        <tr>
            <th>
                商品貨號
            </th>
            <th>
                商品名稱
            </th>
            <th>
                分類
            </th>
            <th>
                狀態
            </th>
            <th>
                員工
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.News)
        {
        <tr>
            <td>
                @item.ItemCode
            </td>
            <td>
                @item.ItemName
            </td>
            <td>
                @item.SpecName
            </td>
            <td>
                @item.StatusName
            </td>
            <td>
                @item.EmployeeName
            </td>
            <td>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" id="@item.ItemCode" onclick="showImage(@item.ItemCode)">
                    圖片
                </button>
                <a asp-action="Edit" asp-route-id="@item.ItemCode">修改</a> |
                <a asp-action="Delete" asp-route-id="@item.ItemCode">刪除</a>
            </td>
        </tr>      
        }
    </tbody>
</table>

<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">商品圖片</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            
                <img id="modalImage" src="" width="20%" height="20%"  />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>        
            </div>
        </div>
    </div>
</div>


<script>
    function showImage(ItemCode) {
        // 假設你有一個 API 可以根據 itemCode 獲取圖片的 Base64 編碼
        fetch(`/ItemBasics/GetImg/${ItemCode.id}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text(); // 直接返回文本，因為是 Base64 字串
            })
            .then(base64Image => {
                document.getElementById('modalImage').src = `data:image/png;base64,${base64Image}`;
            })
            .catch(error => {
                console.error('Error fetching image:', error);
                document.getElementById('modalImage').src = ''; // 清空圖片
            });
    }
</script>
